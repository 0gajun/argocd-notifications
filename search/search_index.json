{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Overview \u00b6 Argo CD Notifications continuously monitors Argo CD applications and provides a flexible way to notify users about important changes in the application state. Using flexible mechanism of triggers and templates you can configure when the notification should be sent as well as notification content. Argo CD Notifications includes the set of useful built-in triggers and templates. So you can just enable them instead of reinventing new ones. Getting Started \u00b6 Install Argo CD Notifications kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-notifications/stable/manifests/install.yaml Configure integration with your Slack in argocd-notifications-secret secret: kubectl apply -n argocd -f - << EOF apiVersion: v1 kind: Secret metadata: name: argocd-notifications-secret stringData: notifiers.yaml: | slack: token: <my-token> type: Opaque EOF Enable built-in trigger in the argocd-notifications-cm config map: kubectl apply -n argocd -f - << EOF apiVersion: v1 kind: ConfigMap metadata: name: argocd-notifications-cm data: config.yaml: | triggers: - name: on-sync-succeeded enabled: true EOF Subscribe to notifications by adding the recipients.argocd-notifications.argoproj.io annotation to the Argo CD application or project: kubectl patch app <my-app> -n argocd -p '{\"metadata\": {\"annotations\": {\"recipients.argocd-notifications.argoproj.io\":\"slack:<my-channel>\"}}}' --type merge Try syncing and application and get the notification once sync is completed.","title":"Overview"},{"location":"#overview","text":"Argo CD Notifications continuously monitors Argo CD applications and provides a flexible way to notify users about important changes in the application state. Using flexible mechanism of triggers and templates you can configure when the notification should be sent as well as notification content. Argo CD Notifications includes the set of useful built-in triggers and templates. So you can just enable them instead of reinventing new ones.","title":"Overview"},{"location":"#getting-started","text":"Install Argo CD Notifications kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-notifications/stable/manifests/install.yaml Configure integration with your Slack in argocd-notifications-secret secret: kubectl apply -n argocd -f - << EOF apiVersion: v1 kind: Secret metadata: name: argocd-notifications-secret stringData: notifiers.yaml: | slack: token: <my-token> type: Opaque EOF Enable built-in trigger in the argocd-notifications-cm config map: kubectl apply -n argocd -f - << EOF apiVersion: v1 kind: ConfigMap metadata: name: argocd-notifications-cm data: config.yaml: | triggers: - name: on-sync-succeeded enabled: true EOF Subscribe to notifications by adding the recipients.argocd-notifications.argoproj.io annotation to the Argo CD application or project: kubectl patch app <my-app> -n argocd -p '{\"metadata\": {\"annotations\": {\"recipients.argocd-notifications.argoproj.io\":\"slack:<my-channel>\"}}}' --type merge Try syncing and application and get the notification once sync is completed.","title":"Getting Started"},{"location":"built-in/","text":"Built-in Triggers and Templates \u00b6 Triggers \u00b6 NAME DESCRIPTION TEMPLATE on-sync-status-unknown Application status is 'Unknown' app-sync-status-unknown on-sync-failed Application syncing has failed app-sync-failed on-sync-running Application is being synced app-sync-running on-sync-succeeded Application syncing has succeeded app-sync-succeeded on-health-degraded Application has degraded app-health-degraded Templates \u00b6 app-sync-status-unknown \u00b6 title : Application {{.app.metadata.name}} sync status is 'Unknown' body : {{ if eq .context.notificationType \"slack\" }} :exclamation: {{ end }} Application {{ .app.metadata.name }} sync is 'Unknown'. Application details: {{ .context.argocdUrl }} /applications/ {{ .app.metadata.name }} . {{ if ne .context.notificationType \"slack\" }} {{ range $ c := .app.status.conditions }} * {{ $ c.message }} {{ end }} {{ end }} app-sync-succeeded \u00b6 title : Application {{.app.metadata.name}} has been successfully synced. body : {{ if eq .context.notificationType \"slack\" }} :white_check_mark: {{ end }} Application {{ .app.metadata.name }} has been successfully synced at {{ .app.status.operationState.finishedAt }} . Sync operation details are available at: {{ .context.argocdUrl }} /applications/ {{ .app.metadata.name }} ?operation=true . app-sync-failed \u00b6 title : Failed to sync application {{.app.metadata.name}}. body : {{ if eq .context.notificationType \"slack\" }} :exclamation: {{ end }} The sync operation of application {{ .app.metadata.name }} has failed at {{ .app.status.operationState.finishedAt }} with the following error: {{ .app.status.operationState.message }} Sync operation details are available at: {{ .context.argocdUrl }} /applications/ {{ .app.metadata.name }} ?operation=true . app-sync-running \u00b6 title : Start syncing application {{.app.metadata.name}}. body : The sync operation of application {{ .app.metadata.name }} has started at {{ .app.status.operationState.startedAt }} . Sync operation details are available at: {{ .context.argocdUrl }} /applications/ {{ .app.metadata.name }} ?operation=true . app-health-degraded \u00b6 title : Application {{.app.metadata.name}} has degraded. body : {{ if eq .context.notificationType \"slack\" }} :exclamation: {{ end }} Application {{ .app.metadata.name }} has degraded. Application details: {{ .context.argocdUrl }} /applications/ {{ .app.metadata.name }} .","title":"Built-in Triggers and Templates"},{"location":"built-in/#built-in-triggers-and-templates","text":"","title":"Built-in Triggers and Templates"},{"location":"built-in/#triggers","text":"NAME DESCRIPTION TEMPLATE on-sync-status-unknown Application status is 'Unknown' app-sync-status-unknown on-sync-failed Application syncing has failed app-sync-failed on-sync-running Application is being synced app-sync-running on-sync-succeeded Application syncing has succeeded app-sync-succeeded on-health-degraded Application has degraded app-health-degraded","title":"Triggers"},{"location":"built-in/#templates","text":"","title":"Templates"},{"location":"built-in/#app-sync-status-unknown","text":"title : Application {{.app.metadata.name}} sync status is 'Unknown' body : {{ if eq .context.notificationType \"slack\" }} :exclamation: {{ end }} Application {{ .app.metadata.name }} sync is 'Unknown'. Application details: {{ .context.argocdUrl }} /applications/ {{ .app.metadata.name }} . {{ if ne .context.notificationType \"slack\" }} {{ range $ c := .app.status.conditions }} * {{ $ c.message }} {{ end }} {{ end }}","title":"app-sync-status-unknown"},{"location":"built-in/#app-sync-succeeded","text":"title : Application {{.app.metadata.name}} has been successfully synced. body : {{ if eq .context.notificationType \"slack\" }} :white_check_mark: {{ end }} Application {{ .app.metadata.name }} has been successfully synced at {{ .app.status.operationState.finishedAt }} . Sync operation details are available at: {{ .context.argocdUrl }} /applications/ {{ .app.metadata.name }} ?operation=true .","title":"app-sync-succeeded"},{"location":"built-in/#app-sync-failed","text":"title : Failed to sync application {{.app.metadata.name}}. body : {{ if eq .context.notificationType \"slack\" }} :exclamation: {{ end }} The sync operation of application {{ .app.metadata.name }} has failed at {{ .app.status.operationState.finishedAt }} with the following error: {{ .app.status.operationState.message }} Sync operation details are available at: {{ .context.argocdUrl }} /applications/ {{ .app.metadata.name }} ?operation=true .","title":"app-sync-failed"},{"location":"built-in/#app-sync-running","text":"title : Start syncing application {{.app.metadata.name}}. body : The sync operation of application {{ .app.metadata.name }} has started at {{ .app.status.operationState.startedAt }} . Sync operation details are available at: {{ .context.argocdUrl }} /applications/ {{ .app.metadata.name }} ?operation=true .","title":"app-sync-running"},{"location":"built-in/#app-health-degraded","text":"title : Application {{.app.metadata.name}} has degraded. body : {{ if eq .context.notificationType \"slack\" }} :exclamation: {{ end }} Application {{ .app.metadata.name }} has degraded. Application details: {{ .context.argocdUrl }} /applications/ {{ .app.metadata.name }} .","title":"app-health-degraded"},{"location":"recipients/bot/","text":"Bot (v0.5) \u00b6 The optional bot component simplifies managing subscriptions. The end users can use bot commands to manage subscriptions even if they don't have access to the Kubernetes API and cannot modify annotations. The bot is not installed by default. Use the install-bot.yaml to intall it: kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-notifications/stable/manifests/install-bot.yaml Slack bot Opsgenie bot Telegram bot","title":"Bot (v0.5)"},{"location":"recipients/bot/#bot-v05","text":"The optional bot component simplifies managing subscriptions. The end users can use bot commands to manage subscriptions even if they don't have access to the Kubernetes API and cannot modify annotations. The bot is not installed by default. Use the install-bot.yaml to intall it: kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-notifications/stable/manifests/install-bot.yaml Slack bot Opsgenie bot Telegram bot","title":"Bot (v0.5)"},{"location":"recipients/opsgenie-bot/","text":"Opsgenie bot \u00b6 Do you need Opsgenie bot? Please consider contributing or create feature request !","title":"Opsgenie bot"},{"location":"recipients/opsgenie-bot/#opsgenie-bot","text":"Do you need Opsgenie bot? Please consider contributing or create feature request !","title":"Opsgenie bot"},{"location":"recipients/overview/","text":"Overview \u00b6 The recipients are configured using Application or AppProject CRD annotations. Each recipient is prefixed with the notification service type such as slack or email . Multiple recipients are separated with a comma, e.g. recipients.argocd-notifications.argoproj.io : email:<sample-email>, slack:<sample-channel-name> The example below demonstrates how to subscribe to the email notifications triggered for a specific application: apiVersion : argoproj.io/v1alpha1 kind : Application metadata : annotations : recipients.argocd-notifications.argoproj.io : email:<sample-email> The example below demonstrates how to get to the Slack message on a notification of the any project application: apiVersion : argoproj.io/v1alpha1 kind : AppProject metadata : annotations : recipients.argocd-notifications.argoproj.io : slack:<sample-channel-name> The example below demonstrates how to create a Grafana annotation for a specific application: apiVersion : argoproj.io/v1alpha1 kind : Application metadata : annotations : recipients.argocd-notifications.argoproj.io : grafana:tag1|tag2 Trigger Specific Subscription (v0.3) \u00b6 It is possible to subscribe recipient to a specific trigger instead of all triggers. The annotation key should be prefixed with <trigger-name>. . The example below demonstrates how to receive only on-sync-failed trigger notifications: apiVersion : argoproj.io/v1alpha1 kind : Application metadata : annotations : on-sync-failed.recipients.argocd-notifications.argoproj.io : email:<sample-email> Default Subscriptions (v0.6.1) \u00b6 The recipients might be configured globally in the argocd-notifications-cm ConfigMap. The default subscriptions are applied to all applications and triggers by default. The trigger and applications might be configured using the trigger and selector fields: apiVersion : v1 kind : ConfigMap metadata : name : argocd-notifications-cm data : config.yaml : | subscriptions: # global subscription for all type of notifications - recipients: - slack:test1 - webhook:github # subscription for on-sync-status-unknown trigger notifications - recipients: - slack:test2 - email:test@gmail.com triggers: - on-sync-status-unknown # global subscription restricted to applications with matching labels only - recipients: slack:test3 selector: test=true Manage subscriptions using bots \u00b6 The bot component simplifies managing subscriptions.","title":"Overview"},{"location":"recipients/overview/#overview","text":"The recipients are configured using Application or AppProject CRD annotations. Each recipient is prefixed with the notification service type such as slack or email . Multiple recipients are separated with a comma, e.g. recipients.argocd-notifications.argoproj.io : email:<sample-email>, slack:<sample-channel-name> The example below demonstrates how to subscribe to the email notifications triggered for a specific application: apiVersion : argoproj.io/v1alpha1 kind : Application metadata : annotations : recipients.argocd-notifications.argoproj.io : email:<sample-email> The example below demonstrates how to get to the Slack message on a notification of the any project application: apiVersion : argoproj.io/v1alpha1 kind : AppProject metadata : annotations : recipients.argocd-notifications.argoproj.io : slack:<sample-channel-name> The example below demonstrates how to create a Grafana annotation for a specific application: apiVersion : argoproj.io/v1alpha1 kind : Application metadata : annotations : recipients.argocd-notifications.argoproj.io : grafana:tag1|tag2","title":"Overview"},{"location":"recipients/overview/#trigger-specific-subscription-v03","text":"It is possible to subscribe recipient to a specific trigger instead of all triggers. The annotation key should be prefixed with <trigger-name>. . The example below demonstrates how to receive only on-sync-failed trigger notifications: apiVersion : argoproj.io/v1alpha1 kind : Application metadata : annotations : on-sync-failed.recipients.argocd-notifications.argoproj.io : email:<sample-email>","title":"Trigger Specific Subscription (v0.3)"},{"location":"recipients/overview/#default-subscriptions-v061","text":"The recipients might be configured globally in the argocd-notifications-cm ConfigMap. The default subscriptions are applied to all applications and triggers by default. The trigger and applications might be configured using the trigger and selector fields: apiVersion : v1 kind : ConfigMap metadata : name : argocd-notifications-cm data : config.yaml : | subscriptions: # global subscription for all type of notifications - recipients: - slack:test1 - webhook:github # subscription for on-sync-status-unknown trigger notifications - recipients: - slack:test2 - email:test@gmail.com triggers: - on-sync-status-unknown # global subscription restricted to applications with matching labels only - recipients: slack:test3 selector: test=true","title":"Default Subscriptions (v0.6.1)"},{"location":"recipients/overview/#manage-subscriptions-using-bots","text":"The bot component simplifies managing subscriptions.","title":"Manage subscriptions using bots"},{"location":"recipients/slack-bot/","text":"Slack bot (v0.5) \u00b6 The Slack bot leverages slash commands . The bot allows slack users to view existing channel subscriptions and subscribe or unsubscribe channels. Make sure bot component is installed . Configure slack integration . In the slack application settings page navigate to the 'Slash Commands' section and click 'Create New Command' button. Fill in new slack command details In the slack application settings page navigate to the 'Basic Information' section and copy 'Signing Secret' from the 'App Credentials' section. Add signingSecret to the slack configuration in the notifiers.yaml field of the argocd-notification-secret : apiVersion : v1 kind : Secret metadata : name : argocd-notifications-secret stringData : notifiers.yaml : | slack: token: <my-token> signingSecret: <my-secret> Commands \u00b6 The bot supports following commands: list-subscriptions - list channel subscriptions subscribe <my-app> <optional-trigger> - subscribes channel to the app notifications subscribe proj:<my-app> <optional-trigger> - subscribes channel to the app project notifications unsubscribe <my-app> <optional-trigger> - unsubscribes channel from the app notifications unsubscribe proj:<my-app> <optional-trigger> - unsubscribes channel from the app project notifications","title":"Slack bot (v0.5)"},{"location":"recipients/slack-bot/#slack-bot-v05","text":"The Slack bot leverages slash commands . The bot allows slack users to view existing channel subscriptions and subscribe or unsubscribe channels. Make sure bot component is installed . Configure slack integration . In the slack application settings page navigate to the 'Slash Commands' section and click 'Create New Command' button. Fill in new slack command details In the slack application settings page navigate to the 'Basic Information' section and copy 'Signing Secret' from the 'App Credentials' section. Add signingSecret to the slack configuration in the notifiers.yaml field of the argocd-notification-secret : apiVersion : v1 kind : Secret metadata : name : argocd-notifications-secret stringData : notifiers.yaml : | slack: token: <my-token> signingSecret: <my-secret>","title":"Slack bot (v0.5)"},{"location":"recipients/slack-bot/#commands","text":"The bot supports following commands: list-subscriptions - list channel subscriptions subscribe <my-app> <optional-trigger> - subscribes channel to the app notifications subscribe proj:<my-app> <optional-trigger> - subscribes channel to the app project notifications unsubscribe <my-app> <optional-trigger> - unsubscribes channel from the app notifications unsubscribe proj:<my-app> <optional-trigger> - unsubscribes channel from the app project notifications","title":"Commands"},{"location":"recipients/telegram-bot/","text":"Telegram bot \u00b6 Do you need Telegram bot? Please consider contributing or create feature request !","title":"Telegram bot"},{"location":"recipients/telegram-bot/#telegram-bot","text":"Do you need Telegram bot? Please consider contributing or create feature request !","title":"Telegram bot"},{"location":"services/grafana/","text":"Grafana \u00b6 Requires version v0.6+ To be able to create Grafana annotation with argocd-notifications you have to create an API Key inside your Grafana . Login to your Grafana instance as admin On the left menu, go to Configuration / API Keys Click \"Add API Key\" Fill the Key with name ArgoCD Notification , role Editor and Time to Live 10y (for example) Click on Add button Copy your API Key and define it in notifiers.yaml apiVersion : v1 kind : Secret metadata : name : argocd-notifications-secret stringData : notifiers.yaml : | grafana: apiUrl: https://grafana.example.com/api apiKey: <grafana-api-key>","title":"Grafana"},{"location":"services/grafana/#grafana","text":"Requires version v0.6+ To be able to create Grafana annotation with argocd-notifications you have to create an API Key inside your Grafana . Login to your Grafana instance as admin On the left menu, go to Configuration / API Keys Click \"Add API Key\" Fill the Key with name ArgoCD Notification , role Editor and Time to Live 10y (for example) Click on Add button Copy your API Key and define it in notifiers.yaml apiVersion : v1 kind : Secret metadata : name : argocd-notifications-secret stringData : notifiers.yaml : | grafana: apiUrl: https://grafana.example.com/api apiKey: <grafana-api-key>","title":"Grafana"},{"location":"services/opsgenie/","text":"Opsgenie \u00b6 To be able to send notifications with argocd-notifications you have to create an API Integration inside your Opsgenie Team . Login to Opsgenie at https://app.opsgenie.com or https://app.eu.opsgenie.com (if you have an account in the european union) Make sure you already have a team, if not follow this guide https://docs.opsgenie.com/docs/teams Click \"Teams\" in the Menu on the left Select the team that you want to notify In the teams configuration menu select \"Integrations\" click \"Add Integration\" in the top right corner Select \"API\" integration Give your integration a name, copy the \"API key\" and safe it somewhere for later Make sure the checkboxes for \"Create and Update Access\" and \"enable\" are selected, disable the other checkboxes to remove unnecessary permissions Click \"Safe Integration\" at the bottom Check your browser for the correct server apiURL. If it is \"app.opsgenie.com\" then use the us/international api url api.opsgenie.com in the next step, otherwise use api.eu.opsgenie.com (european api). You are finished with configuring opsgenie. Now you need to configure argocd-notifications. Use the apiUrl, the team name and the apiKey to configure the opsgenie integration in the argocd-notifications-secret secret. apiVersion : v1 kind : Secret metadata : name : argocd-notifications-secret stringData : notifiers.yaml : | opsgenie: apiUrl: <api-url> apiKeys: <your-team>: <integration-api-key>","title":"Opsgenie"},{"location":"services/opsgenie/#opsgenie","text":"To be able to send notifications with argocd-notifications you have to create an API Integration inside your Opsgenie Team . Login to Opsgenie at https://app.opsgenie.com or https://app.eu.opsgenie.com (if you have an account in the european union) Make sure you already have a team, if not follow this guide https://docs.opsgenie.com/docs/teams Click \"Teams\" in the Menu on the left Select the team that you want to notify In the teams configuration menu select \"Integrations\" click \"Add Integration\" in the top right corner Select \"API\" integration Give your integration a name, copy the \"API key\" and safe it somewhere for later Make sure the checkboxes for \"Create and Update Access\" and \"enable\" are selected, disable the other checkboxes to remove unnecessary permissions Click \"Safe Integration\" at the bottom Check your browser for the correct server apiURL. If it is \"app.opsgenie.com\" then use the us/international api url api.opsgenie.com in the next step, otherwise use api.eu.opsgenie.com (european api). You are finished with configuring opsgenie. Now you need to configure argocd-notifications. Use the apiUrl, the team name and the apiKey to configure the opsgenie integration in the argocd-notifications-secret secret. apiVersion : v1 kind : Secret metadata : name : argocd-notifications-secret stringData : notifiers.yaml : | opsgenie: apiUrl: <api-url> apiKeys: <your-team>: <integration-api-key>","title":"Opsgenie"},{"location":"services/overview/","text":"Notification Services \u00b6 The notification services are configured in the notifiers.yaml field of the argocd-notifications-secret.yaml Secret: apiVersion : v1 kind : Secret metadata : name : argocd-notifications-secret stringData : notifiers.yaml : | email: host: smtp.gmail.com port: 587 from: <myemail>@gmail.com username: <myemail>@gmail.com password: <mypassword> slack: token: <my-token> username: <override-username> # optional username icon: <override-icon> # optional icon for the message (supports both emoij and url notation) opsgenie: apiUrl: api.opsgenie.com apiKeys: <team-id>: <my-api-key> ... type : Opaque","title":"Overview"},{"location":"services/overview/#notification-services","text":"The notification services are configured in the notifiers.yaml field of the argocd-notifications-secret.yaml Secret: apiVersion : v1 kind : Secret metadata : name : argocd-notifications-secret stringData : notifiers.yaml : | email: host: smtp.gmail.com port: 587 from: <myemail>@gmail.com username: <myemail>@gmail.com password: <mypassword> slack: token: <my-token> username: <override-username> # optional username icon: <override-icon> # optional icon for the message (supports both emoij and url notation) opsgenie: apiUrl: api.opsgenie.com apiKeys: <team-id>: <my-api-key> ... type : Opaque","title":"Notification Services"},{"location":"services/slack/","text":"Slack \u00b6 Create Slack Application using https://api.slack.com/apps?new_app=1 Once application is created navigate to Enter OAuth & Permissions Click Permissions under Add features and functionality section and add chat:write:bot scope. To use the optional username and icon overrides in the Slack notification service also add the chat:write.customize scope. Scroll back to the top, click 'Install App to Workspace' button and confirm the installation. Once installation is completed copy the OAuth token. Finally use the OAuth token to configure the slack integration in the argocd-notifications-secret secret: apiVersion : v1 kind : Secret metadata : name : argocd-notifications-secret stringData : notifiers.yaml : | email: host: smtp.gmail.com port: 587 from: <myemail>@gmail.com username: <myemail>@gmail.com password: <mypassword> slack: token: <my-token> username: <override-username> # optional username","title":"Slack"},{"location":"services/slack/#slack","text":"Create Slack Application using https://api.slack.com/apps?new_app=1 Once application is created navigate to Enter OAuth & Permissions Click Permissions under Add features and functionality section and add chat:write:bot scope. To use the optional username and icon overrides in the Slack notification service also add the chat:write.customize scope. Scroll back to the top, click 'Install App to Workspace' button and confirm the installation. Once installation is completed copy the OAuth token. Finally use the OAuth token to configure the slack integration in the argocd-notifications-secret secret: apiVersion : v1 kind : Secret metadata : name : argocd-notifications-secret stringData : notifiers.yaml : | email: host: smtp.gmail.com port: 587 from: <myemail>@gmail.com username: <myemail>@gmail.com password: <mypassword> slack: token: <my-token> username: <override-username> # optional username","title":"Slack"},{"location":"services/telegram/","text":"Telegram \u00b6 Do you need Telegram support? Please consider contributing or thumbs up feature request !","title":"Telegram"},{"location":"services/telegram/#telegram","text":"Do you need Telegram support? Please consider contributing or thumbs up feature request !","title":"Telegram"},{"location":"services/webhook/","text":"Webhook \u00b6 Requires version v0.6+ The webhook notification service allows sending a generic HTTP request using the templatized request body and URL. Using Webhook you might trigger a Jenkins job, update Github commit status. Use the following steps to configure webhook: 1 Register webhook in argocd-notifications-secret secret under webhook section in notifiers.yaml field: apiVersion : v1 kind : Secret metadata : name : argocd-notifications-secret stringData : notifiers.yaml : | webhook: - name: <webhook-name> url: https://<hostname>/<optional-path> headers: #optional headers - name: <header-name> value: <header-value> basicAuth: #optional username password username: <username> password: <api-key> type : Opaque 2 Use template to customize request method, path and body: apiVersion : v1 kind : ConfigMap metadata : name : argocd-notifications-cm data : config.yaml : | templates: - name: <template-name> webhook: <webhook-name>: method: POST # one of: GET, POST, PUT, PATCH. Default value: GET path: <optional-path-template> body: | <optional-body-template> 3 Create application/project subscription: apiVersion : argoproj.io/v1alpha1 kind : Application metadata : annotations : recipients.argocd-notifications.argoproj.io : webhook:<webhook-name> name : <my-app> Examples \u00b6 Set Github commit status \u00b6 apiVersion : v1 kind : Secret metadata : name : argocd-notifications-secret stringData : notifiers.yaml : | webhook: - name: github url: https://api.github.com headers: - name: Authorization value: token <token> type : Opaque apiVersion : v1 kind : ConfigMap metadata : name : argocd-notifications-cm data : config.yaml : | triggers: - name: sync-operation-failed condition: app.status.operationState.phase in ['Error', 'Failed'] template: sync-operation-status-change - name: sync-operation-succeeded condition: app.status.operationState.phase in ['Succeeded'] template: sync-operation-status-change - name: sync-operation-running condition: app.status.operationState.phase in ['Running'] template: sync-operation-status-change templates: - name: sync-operation-status-change webhook: github: method: POST path: /repos/{{call .repo.FullNameByRepoURL .app.spec.source.repoURL}}/statuses/{{.app.status.operationState.operation.sync.revision}} body: | { {{if eq .app.status.operationState.phase \"Running\"}} \"state\": \"pending\"{{end}} {{if eq .app.status.operationState.phase \"Succeeded\"}} \"state\": \"success\"{{end}} {{if eq .app.status.operationState.phase \"Error\"}} \"state\": \"error\"{{end}} {{if eq .app.status.operationState.phase \"Failed\"}} \"state\": \"error\"{{end}}, \"description\": \"ArgoCD\", \"target_url\": \"{{.context.argocdUrl}}/applications/{{.app.metadata.name}}\", \"context\": \"continuous-delivery/{{.app.metadata.name}}\" } Start Jenkins Job \u00b6 apiVersion : v1 kind : Secret metadata : name : argocd-notifications-secret stringData : notifiers.yaml : | webhook: - name: jenkins url: http://<jenkins-host>/job/<job-name>/build?token=<job-secret> basicAuth: username: <username> password: <api-key> type : Opaque","title":"Webhook"},{"location":"services/webhook/#webhook","text":"Requires version v0.6+ The webhook notification service allows sending a generic HTTP request using the templatized request body and URL. Using Webhook you might trigger a Jenkins job, update Github commit status. Use the following steps to configure webhook: 1 Register webhook in argocd-notifications-secret secret under webhook section in notifiers.yaml field: apiVersion : v1 kind : Secret metadata : name : argocd-notifications-secret stringData : notifiers.yaml : | webhook: - name: <webhook-name> url: https://<hostname>/<optional-path> headers: #optional headers - name: <header-name> value: <header-value> basicAuth: #optional username password username: <username> password: <api-key> type : Opaque 2 Use template to customize request method, path and body: apiVersion : v1 kind : ConfigMap metadata : name : argocd-notifications-cm data : config.yaml : | templates: - name: <template-name> webhook: <webhook-name>: method: POST # one of: GET, POST, PUT, PATCH. Default value: GET path: <optional-path-template> body: | <optional-body-template> 3 Create application/project subscription: apiVersion : argoproj.io/v1alpha1 kind : Application metadata : annotations : recipients.argocd-notifications.argoproj.io : webhook:<webhook-name> name : <my-app>","title":"Webhook"},{"location":"services/webhook/#examples","text":"","title":"Examples"},{"location":"services/webhook/#set-github-commit-status","text":"apiVersion : v1 kind : Secret metadata : name : argocd-notifications-secret stringData : notifiers.yaml : | webhook: - name: github url: https://api.github.com headers: - name: Authorization value: token <token> type : Opaque apiVersion : v1 kind : ConfigMap metadata : name : argocd-notifications-cm data : config.yaml : | triggers: - name: sync-operation-failed condition: app.status.operationState.phase in ['Error', 'Failed'] template: sync-operation-status-change - name: sync-operation-succeeded condition: app.status.operationState.phase in ['Succeeded'] template: sync-operation-status-change - name: sync-operation-running condition: app.status.operationState.phase in ['Running'] template: sync-operation-status-change templates: - name: sync-operation-status-change webhook: github: method: POST path: /repos/{{call .repo.FullNameByRepoURL .app.spec.source.repoURL}}/statuses/{{.app.status.operationState.operation.sync.revision}} body: | { {{if eq .app.status.operationState.phase \"Running\"}} \"state\": \"pending\"{{end}} {{if eq .app.status.operationState.phase \"Succeeded\"}} \"state\": \"success\"{{end}} {{if eq .app.status.operationState.phase \"Error\"}} \"state\": \"error\"{{end}} {{if eq .app.status.operationState.phase \"Failed\"}} \"state\": \"error\"{{end}}, \"description\": \"ArgoCD\", \"target_url\": \"{{.context.argocdUrl}}/applications/{{.app.metadata.name}}\", \"context\": \"continuous-delivery/{{.app.metadata.name}}\" }","title":"Set Github commit status"},{"location":"services/webhook/#start-jenkins-job","text":"apiVersion : v1 kind : Secret metadata : name : argocd-notifications-secret stringData : notifiers.yaml : | webhook: - name: jenkins url: http://<jenkins-host>/job/<job-name>/build?token=<job-secret> basicAuth: username: <username> password: <api-key> type : Opaque","title":"Start Jenkins Job"},{"location":"triggers_and_templates/","text":"Overview \u00b6 Triggers and templates are configured in the config.yaml field of the argocd-notification-cm ConfigMap: apiVersion : v1 kind : ConfigMap metadata : name : argocd-notifications-cm data : config.yaml : | subscriptions: # global subscription for all type of notifications - recipients: - slack:test1 - webhook:github # subscription for on-sync-status-unknown trigger notifications - recipients: - slack:test2 - email:test@gmail.com trigger: on-sync-status-unknown # global subscription restricted to applications with matching labels only - recipients: - slack:test3 selector: test=true triggers: # Enable existing built-in trigger - name: on-sync-status-unknown enabled: true # Define your custom trigger - name: my-custom-trigger condition: app.status.sync.status == 'Unknown' template: my-custom-template templates: # Add your custom template - name: my-custom-template title: Hello {{.app.metadata.name}} body: | Application details: {{.context.argocdUrl}}/applications/{{.app.metadata.name}}. # Override one field in built-in template - name: app-sync-status title: Application {{.app.metadata.name}} sync status is {{.app.status.sync.status}} Triggers \u00b6 The trigger defines the condition when the notification should be sent. The definition includes name, condition and notification template reference. The following trigger sends a notification when application sync status changes to Unknown : - name: on-sync-status-unknown condition: app.status.sync.status == 'Unknown' template: app-sync-status enabled: true name - a unique trigger identifier. template - the name of the template that defines the notification content. condition - a predicate expression that returns true if the notification should be sent. The trigger condition evaluation is powered by antonmedv/expr . The condition language syntax is described at Language-Definition.md . enabled - flag that indicates if trigger is enabled or not. By default trigger is enabled. Functions \u00b6 Following functions can be used with-in the condition expression: time (v0.5+) time.Now - executes function built-in Golang time.Now function. time.Parse - parses specified string using RFC3339 layout repo (v0.6+) repo.RepoURLToHTTPS - transforms given GIT URL into HTTPs format repo.FullNameByRepoURL - returns repository URL full name ( / ). Currently supports only Github, Gitlab and Bitbucket. Templates \u00b6 The notification template is used to generate the notification content. The template is leveraging html/template golang package and allow to define notification title and body. The template is meant to be reusable and can be referenced by multiple triggers. The following template is used to notify the user about application sync status. - name: app-sync-status title: Application {{ .app.metadata.name }} sync status is {{ .app.status.sync.status }} body: | Application {{ .app.metadata.name }} sync is {{ .app.status.sync.status }} . Application details: {{ .context.argocdUrl }} /applications/ {{ .app.metadata.name }} . Each template has access to the app and context fields: app holds the application object. context is user defined string map and might include any string keys and values.","title":"Overview"},{"location":"triggers_and_templates/#overview","text":"Triggers and templates are configured in the config.yaml field of the argocd-notification-cm ConfigMap: apiVersion : v1 kind : ConfigMap metadata : name : argocd-notifications-cm data : config.yaml : | subscriptions: # global subscription for all type of notifications - recipients: - slack:test1 - webhook:github # subscription for on-sync-status-unknown trigger notifications - recipients: - slack:test2 - email:test@gmail.com trigger: on-sync-status-unknown # global subscription restricted to applications with matching labels only - recipients: - slack:test3 selector: test=true triggers: # Enable existing built-in trigger - name: on-sync-status-unknown enabled: true # Define your custom trigger - name: my-custom-trigger condition: app.status.sync.status == 'Unknown' template: my-custom-template templates: # Add your custom template - name: my-custom-template title: Hello {{.app.metadata.name}} body: | Application details: {{.context.argocdUrl}}/applications/{{.app.metadata.name}}. # Override one field in built-in template - name: app-sync-status title: Application {{.app.metadata.name}} sync status is {{.app.status.sync.status}}","title":"Overview"},{"location":"triggers_and_templates/#triggers","text":"The trigger defines the condition when the notification should be sent. The definition includes name, condition and notification template reference. The following trigger sends a notification when application sync status changes to Unknown : - name: on-sync-status-unknown condition: app.status.sync.status == 'Unknown' template: app-sync-status enabled: true name - a unique trigger identifier. template - the name of the template that defines the notification content. condition - a predicate expression that returns true if the notification should be sent. The trigger condition evaluation is powered by antonmedv/expr . The condition language syntax is described at Language-Definition.md . enabled - flag that indicates if trigger is enabled or not. By default trigger is enabled.","title":"Triggers"},{"location":"triggers_and_templates/#functions","text":"Following functions can be used with-in the condition expression: time (v0.5+) time.Now - executes function built-in Golang time.Now function. time.Parse - parses specified string using RFC3339 layout repo (v0.6+) repo.RepoURLToHTTPS - transforms given GIT URL into HTTPs format repo.FullNameByRepoURL - returns repository URL full name ( / ). Currently supports only Github, Gitlab and Bitbucket.","title":"Functions"},{"location":"triggers_and_templates/#templates","text":"The notification template is used to generate the notification content. The template is leveraging html/template golang package and allow to define notification title and body. The template is meant to be reusable and can be referenced by multiple triggers. The following template is used to notify the user about application sync status. - name: app-sync-status title: Application {{ .app.metadata.name }} sync status is {{ .app.status.sync.status }} body: | Application {{ .app.metadata.name }} sync is {{ .app.status.sync.status }} . Application details: {{ .context.argocdUrl }} /applications/ {{ .app.metadata.name }} . Each template has access to the app and context fields: app holds the application object. context is user defined string map and might include any string keys and values.","title":"Templates"},{"location":"triggers_and_templates/slack/","text":"Slack (v0.4.0+) \u00b6 Notification templates can be customized to leverage slack message blocks and attachments feature . The message blocks and attachments can be specified in blocks and attachments string fields under slack field: templates : - name : app-sync-status title : Application {{.app.metadata.name}} sync status is {{.app.status.sync.status}} body : | Application {{.app.metadata.name}} sync is {{.app.status.sync.status}}. Application details: {{.context.argocdUrl}}/applications/{{.app.metadata.name}}. slack : attachments : | [{ \"title\": \"{{.app.metadata.name}}\", \"title_link\": \"{{.context.argocdUrl}}/applications/{{.app.metadata.name}}\", \"color\": \"#18be52\", \"fields\": [{ \"title\": \"Sync Status\", \"value\": \"{{.app.status.sync.status}}\", \"short\": true }, { \"title\": \"Repository\", \"value\": \"{{.app.spec.source.repoURL}}\", \"short\": true }] }]","title":"Slack (v0.4.0+)"},{"location":"triggers_and_templates/slack/#slack-v040","text":"Notification templates can be customized to leverage slack message blocks and attachments feature . The message blocks and attachments can be specified in blocks and attachments string fields under slack field: templates : - name : app-sync-status title : Application {{.app.metadata.name}} sync status is {{.app.status.sync.status}} body : | Application {{.app.metadata.name}} sync is {{.app.status.sync.status}}. Application details: {{.context.argocdUrl}}/applications/{{.app.metadata.name}}. slack : attachments : | [{ \"title\": \"{{.app.metadata.name}}\", \"title_link\": \"{{.context.argocdUrl}}/applications/{{.app.metadata.name}}\", \"color\": \"#18be52\", \"fields\": [{ \"title\": \"Sync Status\", \"value\": \"{{.app.status.sync.status}}\", \"short\": true }, { \"title\": \"Repository\", \"value\": \"{{.app.spec.source.repoURL}}\", \"short\": true }] }]","title":"Slack (v0.4.0+)"}]}